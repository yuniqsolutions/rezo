import{Rezo as d}from"../../../core/rezo.js";import{OXYLABS_BROWSER_TYPES as _,OXYLABS_COMMON_LOCALES as y,OXYLABS_COMMON_GEO_LOCATIONS as O,OXYLABS_US_STATES as b,OXYLABS_EUROPEAN_COUNTRIES as m,OXYLABS_ASIAN_COUNTRIES as L,getRandomBrowserType as S,getRandomLocale as A,getRandomGeoLocation as T}from"./options.js";var u="https://realtime.oxylabs.io/v1/queries";class i{config;http;authHeader;constructor(e){if(!e.username||!e.password)throw Error("Oxylabs username and password are required");this.config={username:e.username,password:e.password,browserType:e.browserType??"desktop",locale:e.locale??"en-US",geoLocation:e.geoLocation??"",render:e.render??!1,context:e.context??{},timeout:e.timeout??120000},this.http=new d({baseURL:u,timeout:this.config.timeout}),this.authHeader=`Basic ${Buffer.from(`${e.username}:${e.password}`).toString("base64")}`}async scrape(e,t){let r={...this.config,...t},s=this.buildRequestBody(e,r),o=(await this.http.postJson(u,s,{headers:{Authorization:this.authHeader,"Content-Type":"application/json"}})).data;if(o.error)throw Error(`Oxylabs API error: ${o.error}`);if(!o.results||o.results.length===0)throw Error("Oxylabs API returned no results");let a=o.results[0],c=a._response?.cookies||[],p=a._response?.headers||{};return{statusCode:a.status_code,url:a.url,content:a.content,cookies:c,headers:p,jobId:o.job_id||a.job_id,rendered:r.render,geoLocation:r.geoLocation||void 0,locale:r.locale,browserType:r.browserType,raw:o}}async scrapeMany(e,t,r=1000){let s=[];for(let n=0;n<e.length;n++){let o=await this.scrape(e[n],t);if(s.push(o),n<e.length-1&&r>0)await new Promise((a)=>setTimeout(a,r))}return s}buildRequestBody(e,t){let r=[];if(r.push({key:"return_page_cookies",value:!0}),r.push({key:"return_page_headers",value:!0}),t.context)for(let[n,o]of Object.entries(t.context))r.push({key:n,value:o});let s={source:"universal",url:e,context:r};if(t.render)s.render="html";if(t.browserType)s.user_agent_type=t.browserType;if(t.locale)s.locale=t.locale;if(t.geoLocation)s.geo_location=t.geoLocation;return s}getConfig(){return{...this.config,password:"***"}}withConfig(e){return new i({...this.config,...e})}async testConnection(){try{return await this.scrape("https://httpbin.org/ip"),!0}catch(e){throw Error(`Oxylabs connection test failed: ${e.message}`)}}}var B=i;export{A as getRandomLocale,T as getRandomGeoLocation,S as getRandomBrowserType,B as default,i as Oxylabs,b as OXYLABS_US_STATES,m as OXYLABS_EUROPEAN_COUNTRIES,y as OXYLABS_COMMON_LOCALES,O as OXYLABS_COMMON_GEO_LOCATIONS,_ as OXYLABS_BROWSER_TYPES,L as OXYLABS_ASIAN_COUNTRIES};
